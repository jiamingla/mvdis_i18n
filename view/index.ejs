<!DOCTYPE html>
<html>
<head>
    <title><%= title %></title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/resources/demos/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
    <script>
    const text_sign_up = '報名';
    const text_date = '日期';
    const text_description = '資訊';
    const text_number = '剩餘名額';
    $( function() {
        $( "#datepicker" ).datepicker({
            defaultDate:"+2",
            duration: "slow",
            dateFormat: "yy-mm-dd",
            minDate : "0d",
            maxDate : "+30d"
    });
    $("#btn_session").on("click", function () {
        $.ajax({
            type: "GET",
            url: "/sessions",
            dataType: "json",
            data: $("form").serialize(),
            success: function (response) {
                console.log($("form").serializeArray()[0]);
                let html = `<table border="1" class="table">\
                    <thead class="table-dark">\
                        <tr>\
                        <th scope="col" class="col-2">${text_date}</th>\
                        <th scope="col" class="col-8">${text_description}</th>\
                        <th scope="col" class="col-1">${text_number}</th>\
                        <th scope="col" class="col-1"></th>\
                        </tr>\
                    </thead>`;
                const data = response['data'];
                console.log(data.length);
                for(let i=0; i<data.length; i++){
                    console.log(data[i]);
                    html = html+'<tr>';
                    html = html+`<td class="col-2">${data[i].date}</td>`;
                    html = html+`<td class="col-8">${data[i].description}</td>`;
                    html = html+`<td class="col-1">${data[i].number}</td>`;
                    let btn_sign_up = '';
                    if (data[i].number >0){
                        btn_sign_up = `<button type="button" name="btn_sign_up" class="btn btn-success" onclick(${data[i].secId},${data[i].divId}) >${text_sign_up}</button>`;
                    }
                    html = html+`<td class="col-1">${btn_sign_up}</td>`;
                    html = html+'</tr>';
                }
                html = html+'</table>';
                $("#result").html(html);
            },
            error: function (thrownError) {
                console.log(thrownError);
            }
        });
     });
    });

    </script>
</head>
<body>
    <h1><%= title %></h1>
    <select name="language" class="form-select" size="3">
        <option value="English">English</option>
        <option value="Pilipino">Pilipino</option>
    </select>
    <form method="GET" action="/sessions">
    <select name="licenseTypeCode" class="form-select" size="3" required>
        <option>駕照</option>
        <option value="3">普通重型機車</option>
        <option value="2">普通輕型機車</option>
    </select>
    </select>
    <select name="dmvNo" class="form-select" size="3" required>
        <option>監理所</option>
        <option value="40">臺北區監理所</option>
        <option value="41">板橋監理站</option>
    </select>
    <div class="form-floating">
    <input name="expectExamDateStr" class="form-control" id="datepicker"  type="text" placeholder="Date" required>
    <label for="datepicker">日期</label>
    </div>
    <button type="button" id="btn_session" class="btn btn-primary">Push Me</button>
    </form>
    <div id="result"></div>
</body>
</html>